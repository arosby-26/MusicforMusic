<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>MusicforMusic</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; display: flex; justify-content: center; padding: 40px; }
        .player { background: #181818; padding: 25px; border-radius: 20px; width: 380px; box-shadow: 0 15px 35px rgba(0,0,0,0.7); }
        .controls, .eq-controls { margin: 20px 0; display: flex; flex-direction: column; gap: 10px; }
        .row { display: flex; justify-content: space-between; align-items: center; background: #282828; padding: 10px; border-radius: 10px; }
        input[type="range"] { cursor: pointer; width: 120px; accent-color: #1DB954; }
        button { background: #1DB954; border: none; padding: 12px; border-radius: 50px; color: black; font-weight: bold; cursor: pointer; }
        .playlist { list-style: none; padding: 0; max-height: 150px; overflow-y: auto; border-top: 1px solid #333; }
        .playlist li { padding: 10px; cursor: pointer; border-radius: 5px; }
        .playlist li:hover { background: #282828; }
        .active { color: #1DB954; font-weight: bold; }
    </style>
</head>
<body>

<div class="player">
    <h3 id="display-title">Pilih Lagu dari flashdisk </h3>
    <!-- ID disamakan menjadi audioElement -->
    <audio id="audioElement" crossOrigin="anonymous">  
        <source src="lagu.mp3" type="audio/mpeg">
</audio>

    <div class="controls">
        <button onclick="playPause()" id="btn-play">‚ñ∂ PLAY</button>
        <div style="display:flex; gap:10px; justify-content: center;">
            <button onclick="prev()">‚èÆ Prev</button>
            <button onclick="next()">Next ‚è≠</button>
        </div>
    </div>

    <div class="eq-controls">
        <div class="row">
            <span>üîä Volume</span>
            <input type="range" id="vol-control" min="0" max="1" step="0.1" value="0.5">
        </div>
        <div class="row">
            <span>üé∏ Bass</span>
            <input type="range" id="bass-control" min="-10" max="10" step="1" value="0">
        </div>
        <div class="row">
            <span>üéº Treble</span>
            <input type="range" id="treble-control" min="-10" max="10" step="1" value="0">
        </div>
    </div>

    <ul class="playlist" id="playlist-list"></ul>
</div>

<script>
    const songs = [
        { title: "Dangdut music", url: "dangdut_music.mp3"},
        { title: "Campur sari", url: "campur_sari.mp3" }
    ];

    let currentIndex = 0;
    // Memperbaiki pemanggilan ID agar cocok dengan HTML
    const audio = document.getElementById('audioElement');
    const playBtn = document.getElementById('btn-play');
    
    // Inisialisasi Audio Context (Hanya setelah interaksi user)
    let audioCtx;
    let source;
    let bassFilter;
    let trebleFilter;

    function initAudioContext() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            source = audioCtx.createMediaElementSource(audio);

            bassFilter = audioCtx.createBiquadFilter();
            bassFilter.type = "lowshelf";
            bassFilter.frequency.value = 200;

            trebleFilter = audioCtx.createBiquadFilter();
            trebleFilter.type = "highshelf";
            trebleFilter.frequency.value = 3000;

            source.connect(bassFilter);
            bassFilter.connect(trebleFilter);
            trebleFilter.connect(audioCtx.destination);
            
            // Pasang event slider setelah context dibuat
            document.getElementById('bass-control').oninput = (e) => bassFilter.gain.value = e.target.value;
            document.getElementById('treble-control').oninput = (e) => trebleFilter.gain.value = e.target.value;
        }
    }

    document.getElementById('vol-control').oninput = (e) => audio.volume = e.target.value;

    function playPause() {
        initAudioContext(); // Jalankan context saat tombol ditekan
        if (audioCtx.state === 'suspended') audioCtx.resume();
        
        if (audio.src === "" || audio.src === window.location.href) { 
            loadSong(0); 
            return; 
        }

        if (audio.paused) {
            audio.play();
            playBtn.innerText = "‚è∏ PAUSE";
        } else {
            audio.pause();
            playBtn.innerText = "‚ñ∂ PLAY";
        }
    }

    function loadSong(index) {
        initAudioContext();
        currentIndex = index;
        audio.src = songs[currentIndex].url;
        document.getElementById('display-title').innerText = songs[currentIndex].title;
        
        // Tandai lagu aktif di playlist
        updatePlaylistStyle(index);
        
        audio.play().catch(e => console.log("Error playing:", e));
        playBtn.innerText = "‚è∏ PAUSE";
    }

    function next() { currentIndex = (currentIndex + 1) % songs.length; loadSong(currentIndex); }
    function prev() { currentIndex = (currentIndex - 1 + songs.length) % songs.length; loadSong(currentIndex); }

    function updatePlaylistStyle(index) {
        const items = document.querySelectorAll('.playlist li');
        items.forEach((li, i) => {
            li.className = (i === index) ? "active" : "";
        });
    }

    // Render Playlist
    songs.forEach((s, i) => {
        let li = document.createElement('li');
        li.innerHTML = s.title;
        li.onclick = () => loadSong(i);
        document.getElementById('playlist-list').appendChild(li);
    });
</script>

</body>
</html>
